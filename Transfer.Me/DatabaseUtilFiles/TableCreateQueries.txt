CREATE TABLE tmuser (
	UserID BIGINT NOT NULL AUTO_INCREMENT NOT NULL PRIMARY KEY,
	UserName VARCHAR(255) NOT NULL,
	Email VARCHAR(255) NOT NULL,
	LastLogin DATETIME NOT NULL
);

CREATE TABLE device(
	DeviceID BIGINT NOT NULL AUTO_INCREMENT NOT NULL PRIMARY KEY,
	UserID BIGINT NOT NULL,
	FOREIGN KEY(UserID) REFERENCES tmuser (UserID) ON DELETE CASCADE,
	PublicKey BIGINT NOT NULL
);

CREATE TABLE encryptedfile(
	FileID BIGINT PRIMARY KEY AUTO_INCREMENT NOT NULL,
	FileSize BIGINT NOT NULL,
	Descript VARCHAR(255) NOT NULL,
	FileData BLOB NOT NULL,
	UserID BIGINT NOT NULL,
	FOREIGN KEY (UserID) REFERENCES tmuser (UserID) ON DELETE CASCADE
);

CREATE TABLE recipient(
	RecipientID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	FileID BIGINT NOT NULL,
	FOREIGN KEY(FileID) REFERENCES encryptedfile (FileID) ON DELETE CASCADE,
	UserID BIGINT NOT NULL,
	FOREIGN KEY(UserID) REFERENCES tmuser (UserID) ON DELETE CASCADE
);

CREATE TABLE recipientfilekey(
	DeviceKeyID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	EncryptedKey BIGINT NOT NULL,
	RecipientID BIGINT NOT NULL, 
	FOREIGN KEY (RecipientID) REFERENCES recipient (RecipientID) ON DELETE CASCADE,
	DeviceID BIGINT NOT NULL,
	FOREIGN KEY(DeviceID) REFERENCES device (DeviceID) ON DELETE CASCADE,
	FileID BIGINT NOT NULL,
	FOREIGN KEY(FileID) REFERENCES encryptedfile (FileID) ON DELETE CASCADE
);

CREATE TABLE filelog(
	FileLogID BIGINT PRIMARY KEY AUTO_INCREMENT NOT NULL,
	Uploaded DATETIME NOT NULL,
	Downloaded DATETIME NOT NULL,
	FileSize BIGINT NOT NULL,
	Descript VARCHAR(255) NOT NULL,
	FileID BIGINT NOT NULL,
	FOREIGN KEY(FileID) REFERENCES encryptedfile (FileID) ON DELETE CASCADE,
	UserID BIGINT NOT NULL,
	FOREIGN KEY(UserID) REFERENCES tmuser (UserID) ON DELETE CASCADE
);

